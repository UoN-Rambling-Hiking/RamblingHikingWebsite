{{ $walkId := now.UnixMicro }}

<div class="tab-pane fade" id='pills-{{ $walkId}}' role="tabpanel" aria-labelledby='pills-{{ $walkId }}-tab' tabindex="0">
  <h2>{{ .Params.name | safeHTML | htmlUnescape }}</h2>
  <div id='{{ $walkId }}-info'></div>
  {{ .Inner  }}
</div>

<script>
  var tab = document.createElement('li');
  tab.className = 'nav-item';
  tab.innerHTML = '<button class="nav-link" id="pills-{{ $walkId }}-tab" data-bs-toggle="pill" data-bs-target="#pills-{{ $walkId }}" type="button" role="tab" aria-controls="pills-{{ $walkId }}" aria-selected="false">{{ .Params.name | safeHTML }}</button>'
  document.getElementById('pills-tab').appendChild(tab);

  {{ $data := dict }}
  {{ $osValue := .Get "os" }}
  {{ $url := printf "https://api.ramsoc.co.uk/?url=%s" $osValue }}
  {{ $url }}
  {{ with try (resources.GetRemote $url) }}
    {{ with .Err }}
      {{ errorf "%s" . }}
    {{ else with .Value }}
      {{ $data = . | transform.Unmarshal }}
      createRoute({{ $data }}, {{ .Params.name | safeHTML }}, {{$walkId}});
      document.getElementById('{{$walkId}}-info').innerHTML = '<p>Distance: ' + ({{ index $data 1 }} / 1000).toFixed(2) + 'km</p><p>Elevation: ' + ({{ index $data 2 }}).toFixed(2) + 'm</p>'
  {{ else }}
      {{ errorf "Unable to get remote resource %q" $url }}
    {{ end }}
  {{ end }}





</script>